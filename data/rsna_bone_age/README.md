# RSNA Bone Age Dataset

## Dataset Information
- **Source:** RSNA Pediatric Bone Age Machine Learning Challenge
- **Images:** ~14,000 hand/wrist X-rays
- **Labels:** Bone age (months), Gender
- **Task:** Predict skeletal maturity from pediatric hand X-rays
- **Format:** PNG images with CSV ground truth

## Download Instructions

### Option 1: Kaggle (Easiest)
```bash
pip install kaggle
kaggle competitions download -c rsna-bone-age
```

### Option 2: Direct Download
1. Visit: https://www.kaggle.com/c/rsna-bone-age
2. Download:
   - `boneage-training-dataset.zip` (~8GB)
   - `Bone Age Ground Truth.csv`

### Option 3: RSNA Website
- https://www.rsna.org/education/ai-resources-and-training/ai-image-challenge

## Directory Structure

```
data/rsna_bone_age/
├── boneage-training-dataset/     # PNG images (~14,000)
│   ├── 0001.png
│   ├── 0002.png
│   └── ...
├── Bone Age Ground Truth.csv     # Labels
└── processed/                    # Generated by prepare_rsna.py
    ├── rsna_calibration.csv
    └── rsna_test.csv
```

## CSV Format

| Column | Description |
|--------|-------------|
| `Image ID` | Image filename (without extension) |
| `Bone Age (months)` | Ground truth bone age (0-216 months) |
| `Sex` | M (male) or F (female) |

## Prepare for Conformal Prediction

```bash
python scripts/prepare_rsna.py
```

This creates:
- **Calibration set:** 800 images (stratified by age/gender)
- **Test set:** 400 images
- **Age classes:** Infant (0-18mo), Toddler (18-60mo), Child (60-144mo), Adolescent (144-216mo)

## Usage

### Classification (4 age bins)
```python
from uncertainty_module.data.rsna_loader import get_rsna_loaders
from uncertainty_module.core.conformal import ConformalPredictor

cal_loader, test_loader = get_rsna_loaders(
    data_dir="data/rsna_bone_age",
    task="classification"  # 4-class
)

cp = ConformalPredictor(alpha=0.05)
cp.calibrate(model, cal_loader)
```

### Regression (bone age in months)
```python
from uncertainty_module.core.conformal import ConformalizedQuantileRegression

cal_loader, test_loader = get_rsna_loaders(task="regression")

# Use conformalized quantile regression for continuous targets
```

## Statistics

| Split | Images | Age Range | Male/Female |
|-------|--------|-----------|-------------|
| Train | ~12,600 | 0-216 mo | ~50/50 |
| Valid | ~1,400 | 0-216 mo | ~50/50 |

## Age Classes (for Classification)

| Class | Age Range | Label |
|-------|-----------|-------|
| Infant | 0-18 months | 0 |
| Toddler | 18-60 months | 1 |
| Child | 60-144 months | 2 |
| Adolescent | 144-216 months | 3 |

## Citation

```bibtex
@article{halabi2019rsna,
  title={The RSNA Pediatric Bone Age Machine Learning Challenge},
  author={Halabi, Safwan S and Prevedello, Luciano M and Kalpathy-Cramer, Jayashree and Mamonov, Artem B and Bilbily, Alexander and Cicero, Mark and Pan, Ian and Pereira, Lucas A and Sousa, Rafael T and Abdala, Nitamar and others},
  journal={Radiology},
  volume={290},
  number={2},
  pages={498--503},
  year={2019}
}
```
